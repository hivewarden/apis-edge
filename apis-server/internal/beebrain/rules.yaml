# BeeBrain Rule Engine Configuration
# Rules are evaluated in order, all matching rules generate insights
# Rules can be added/modified without server restart (hot-reload)
#
# Condition Types:
# - queen_age_productivity: Checks queen age and productivity decline
# - days_since_treatment: Checks days since last varroa treatment
# - days_since_inspection: Checks days since last inspection
# - detection_spike: Checks for unusual hornet activity spikes
#
# Severity Levels:
# - info: Informational, no immediate action needed (blue icon)
# - warning: Should be addressed soon (yellow/orange icon)
# - action-needed: Requires immediate attention (red icon)
#
# Message Template Variables:
# - {{hive_name}}: Name of the hive
# - {{queen_age}}: Human-readable queen age (e.g., "2 years 3 months")
# - {{days}}: Number of days for time-based rules
# - {{count}}: Detection count for spike rules
# - {{multiplier}}: Detection multiplier vs average
# - {{drop_percent}}: Productivity drop percentage

rules:
  - id: queen_aging
    name: Queen Aging Alert
    description: Detects queens over 2 years old (MVP - age-based check only, productivity tracking planned for future)
    condition:
      type: queen_age_productivity
      params:
        min_queen_age_years: 2
        productivity_drop_percent: 20
    severity: warning
    message_template: "Queen in {{hive_name}} is {{queen_age}} old. Consider monitoring productivity and planning for potential requeening."
    suggested_action: "Consider requeening in spring or monitoring closely for supersedure signs."

  - id: treatment_due
    name: Treatment Due Reminder
    description: Alerts when days since last treatment exceeds threshold
    condition:
      type: days_since_treatment
      params:
        max_days: 90
    severity: action-needed
    message_template: "{{hive_name}}: Varroa treatment due ({{days}} days since last treatment)"
    suggested_action: "Schedule varroa treatment within the next week."

  - id: inspection_overdue
    name: Inspection Overdue
    description: Alerts when days since last inspection exceeds threshold
    condition:
      type: days_since_inspection
      params:
        max_days: 14
    severity: info
    message_template: "{{hive_name}}: Consider inspection ({{days}} days since last)"
    suggested_action: "Schedule an inspection to check hive health."

  - id: hornet_activity_spike
    name: Hornet Activity Spike
    description: Detects unusual increase in hornet detections
    condition:
      type: detection_spike
      params:
        window_hours: 24
        threshold_multiplier: 2.0  # 2x the 7-day average
    severity: warning
    message_template: "Unusual hornet activity detected: {{count}} detections in last 24h ({{multiplier}}x normal)"
    suggested_action: "Check APIS unit footage and consider protective measures."
